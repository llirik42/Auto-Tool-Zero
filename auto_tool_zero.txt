Const FEED_RATE = 400  
Const THICKNESS = 8 
Const OFFSET = 20 
Const MAX_DEPTH = 25
Const EPSILON = 0.01
Const NO_TOUCH_ERROR = "Error"


Function getCurrentFeedRate() as Double
	Return GetOemDRO(818)
End Function

Sub SetFeedRate(feedRate as Integer)
	Code "F" & (feedRate 
End Sub

Sub FastZMove(z as Double)
	Code "G00Z" & z
End Sub

Sub PrintMessage(message as String)
	Code "(" & message & ")"
End Sub

Function GetCurrentZ() as Double
	Return GetOemDro(802)
End Function

Sub SetCurrentZ(newZ as Double)
	Call SetDro (2, newZ)  
End Sub

Sub MoveZUntillTouchOrReach(z as Double)
	Code "G31Z" & z

	While IsMoving
	Wend
End Sub


originFeed = getCurrentFeedRate()

call SetFeedRate(FEED_RATE)

call MoveZUntillTouchOrReach(-MAX_DEPTH)

currentZ = GetCurrentZ()
reachedMaxDepth = currentZ < -MAX_DEPTH + EPSILON

If reachedMaxDepth Then
	call PrintMessage(NO_TOUCH_ERROR)	
	call FastZMove(0)
Else
	call SetCurrentZ(THICKNESS) 
	call FastZMove(OFFSET)	       
End If

call SetFeedRate(originFeed)       
